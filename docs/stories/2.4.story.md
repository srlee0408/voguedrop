# Story 2.4: 효과 선택 갤러리 UI (PrompterSection)

## Story

**As a** VogueDrop 사용자,
**I want** 효과, 카메라, 모델 카테고리별로 예시 영상을 보고 선택할 수 있고,
**so that** 원하는 AI 영상 효과를 조합하여 적용할 수 있다.

## Status

Completed

## Acceptance Criteria

1. [x] PrompterSection에 3개의 탭 (효과, 카메라, 모델)이 표시됨
2. [x] 각 탭마다 effect_templates 테이블의 데이터가 갤러리 형태로 표시됨
3. [x] 각 효과 템플릿에는 이름과 예시 이미지/영상이 표시됨
4. [x] 호버시 예시 영상이 자동 재생됨 (영상인 경우)
5. [x] 효과 선택시 시각적 피드백이 제공됨 (선택 표시)
6. [x] 최대 4개까지만 선택 가능하며, 초과시 경고 메시지 표시
7. [x] 선택된 효과는 부모 컴포넌트로 전달됨
8. [x] 로딩 중에는 스켈레톤 UI가 표시됨

## Dev Notes

### API 엔드포인트
```typescript
// app/api/canvas/effects/route.ts
// GET /api/canvas/effects?category=effect|camera|model
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url);
  const category = searchParams.get('category');
  
  const { data, error } = await supabase
    .from('effect_templates')
    .select('*')
    .eq('category_id', categoryId)
    .eq('is_active', true)
    .order('display_order');
    
  return Response.json({ effects: data });
}
```

### PrompterSection 컴포넌트 구조
```typescript
interface PrompterSectionProps {
  onEffectSelect: (effect: EffectTemplate) => void;
  selectedEffects: EffectTemplate[];
}

// 탭 구조
const tabs = [
  { id: 'effect', label: '효과', icon: '✨' },
  { id: 'camera', label: '카메라', icon: '📷' },
  { id: 'model', label: '모델', icon: '👤' }
];
```

### 효과 템플릿 데이터 구조
```typescript
interface EffectTemplate {
  id: number;
  name: string;
  categoryId: number;
  prompt: string;
  previewUrl?: string;
  displayOrder: number;
}
```

### 갤러리 아이템 동작
- 클릭: 선택/해제 토글
- 호버: 영상 자동재생 (muted)
- 선택 표시: 체크마크 오버레이 또는 보더 하이라이트

### 최대 선택 개수 제한
- 상수: MAX_EFFECTS = 4
- 초과시 토스트 메시지: "최대 4개까지 효과를 선택할 수 있습니다."

## Tasks / Subtasks

### Task 1: API 엔드포인트 구현 (AC: 2)
- [x] `app/api/canvas/effects/route.ts` 생성
- [x] GET 핸들러 구현
- [x] 카테고리별 필터링 로직
- [x] 에러 핸들링

### Task 2: PrompterSection 기본 구조 구현 (AC: 1)
- [x] 탭 네비게이션 UI 구현
- [x] 탭 전환 상태 관리
- [x] 각 탭별 컨텐츠 영역 구현
- [x] 반응형 디자인 적용

### Task 3: 효과 갤러리 구현 (AC: 2, 3)
- [x] 효과 템플릿 데이터 페칭 (useEffect)
- [x] 갤러리 그리드 레이아웃 구현
- [x] EffectCard 컴포넌트 생성
- [x] 이미지/영상 표시 로직

### Task 4: 인터랙션 구현 (AC: 4, 5)
- [x] 호버시 영상 자동재생 기능
- [x] 클릭시 선택/해제 토글
- [x] 선택 상태 시각적 표시
- [x] 애니메이션 효과 추가

### Task 5: 선택 제한 및 상태 관리 (AC: 6, 7)
- [x] 최대 4개 선택 제한 로직
- [x] 초과시 경고 메시지 표시
- [x] 선택된 효과 배열 관리
- [x] 부모 컴포넌트로 상태 전달

### Task 6: 로딩 및 에러 처리 (AC: 8)
- [x] 스켈레톤 UI 컴포넌트 구현
- [x] 로딩 상태 관리
- [x] API 에러 처리
- [x] 재시도 기능

## Testing

### 테스트 요구사항
- 탭 전환 기능 테스트
- 효과 선택/해제 테스트
- 최대 선택 개수 제한 테스트
- API 호출 및 데이터 렌더링 테스트
- 호버 인터랙션 테스트

### 테스트 시나리오
1. 각 탭 클릭시 해당 카테고리 데이터 로드
2. 효과 4개 선택 후 5번째 선택 시도
3. 선택된 효과 해제 및 재선택
4. API 응답 지연/실패 시나리오
5. 다양한 미디어 타입 (이미지/영상) 표시

## Change Log
- [x] 2025-01-30: 초기 스토리 생성
- [x] 2025-01-30: 구현 완료

## Dev Agent Record

### Agent Model Used
- [x] Primary: Claude 3.5 Sonnet
- [x] Fallback: N/A

### Debug Log References
- [x] Session: 2025-01-30

### Completion Notes
- [x] PrompterSection을 텍스트 입력에서 효과 갤러리로 완전히 재작성
- [x] EffectCard 컴포넌트를 PrompterSection 내부에 통합
- [x] 3개 탭 (효과, 카메라, 모델) 구현 완료
- [x] 최대 4개 효과 선택 제한 구현
- [x] 호버시 비디오 자동재생 기능 구현
- [x] 스켈레톤 UI 및 에러 처리 구현

### File List
실제 생성/수정된 파일:
- [x] app/api/canvas/effects/route.ts (생성)
- [x] app/canvas/_components/PrompterSection.tsx (완전 재작성)
- [x] app/canvas/page.tsx (효과 선택 핸들러 추가)
- [x] app/canvas/_components/LeftPanel.tsx (props 추가)
- [x] types/canvas.ts (EffectTemplate 타입 추가)

## QA Results
- [x] 모든 acceptance criteria 충족
- [x] 타입스크립트 컴파일 에러 없음
- [x] ESLint 경고 해결