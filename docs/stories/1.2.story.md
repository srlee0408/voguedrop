# Story 1.2: Authentication UI

## Story

**As a** user,
**I want** to sign up and log in with email/password,
**so that** I can save my work.

## Status

Ready for Review

## Acceptance Criteria

1. Login page with email/password fields
2. Signup page with email/password/confirm password fields
3. Form validation (email format, password strength)
4. Error messages for invalid inputs
5. Loading states during authentication

## Dev Notes

### Architecture Context

#### Tech Stack References
[Source: docs/fullstack-architecture.md#Technology Stack Table]
- **Authentication**: Supabase Auth 2.0+ - Built-in email/password, session management
- **Frontend Framework**: Next.js 14.2+ with App Router
- **Styling**: Tailwind CSS 3.4+
- **State Management**: React Hooks (built-in)
- **TypeScript**: 5.3+ for type safety

#### Routing Structure
[Source: docs/fullstack-architecture.md#Route Organization]
```
app/
├── (auth)/          # Auth layout group
│   ├── layout.tsx   # Public layout
│   ├── login/
│   └── signup/
```

#### Authentication Flow
[Source: docs/fullstack-architecture.md#User Registration and Login Flow]
- Client sends credentials to API Routes
- API Routes communicate with Supabase Auth
- Session stored in cookies
- Redirect to dashboard after successful auth

#### Supabase Client Configuration
[Source: lib/supabase.ts]
- Supabase client already configured at `/lib/supabase.ts`
- Environment variables set in `.env.local`:
  - `NEXT_PUBLIC_SUPABASE_URL`
  - `NEXT_PUBLIC_SUPABASE_ANON_KEY`

#### Form Patterns
[Source: docs/frontend-architecture.md#Form Handling]
- Use controlled components with React hooks
- No external form library needed for MVP

#### Component Organization
[Source: docs/frontend-architecture.md#Project Structure]
- Feature-specific components in `_components` folders
- Server Components by default
- Client Components with "use client" directive for interactive features

### Previous Story Context
- Story 1.1 focused on project setup - Supabase is already configured
- Basic folder structure established
- Environment variables properly set

### Security Considerations
[Source: docs/fullstack-architecture.md#Authentication Security]
- Token Storage: Handled by Supabase
- Session Management: 7-day refresh, 1-hour access tokens  
- Password Policy: Minimum 8 characters (Supabase defaults)

### Testing

#### Testing Standards
[Source: docs/fullstack-architecture.md#Technology Stack Table]
- Frontend Testing: Vitest 1.2+
- Test files should be colocated with components
- Follow Jest-compatible patterns
- Focus on critical user flows for MVP

## Tasks / Subtasks

- [x] Task 1: Create Supabase auth helper utilities (AC: 1, 2, 3, 4, 5)
  - [x] Create `/lib/supabase/client.ts` for client-side Supabase instance
  - [x] Create `/lib/supabase/server.ts` for server-side Supabase instance
  - [x] Create `/lib/supabase/middleware.ts` for auth middleware helper
  - [x] Define auth types in `/types/auth.ts`

- [x] Task 2: Implement login page UI (AC: 1, 3, 4, 5)
  - [x] Create `/app/(auth)/login/page.tsx` as server component
  - [x] Create `/app/(auth)/login/_components/LoginForm.tsx` as client component
  - [x] Implement email/password input fields with Tailwind CSS styling
  - [x] Add form validation for email format
  - [x] Add loading state during login attempt
  - [x] Display error messages for failed login

- [x] Task 3: Implement signup page UI (AC: 2, 3, 4, 5)
  - [x] Create `/app/(auth)/signup/page.tsx` as server component
  - [x] Create `/app/(auth)/signup/_components/SignupForm.tsx` as client component
  - [x] Implement email/password/confirm password fields
  - [x] Add password strength validation (min 8 chars)
  - [x] Add password confirmation matching
  - [x] Add loading state during signup
  - [x] Display error messages for validation and signup failures

- [x] Task 4: Create auth layout (AC: 1, 2)
  - [x] Create `/app/(auth)/layout.tsx` for shared auth page layout
  - [x] Add navigation between login/signup pages
  - [x] Style with consistent design using Tailwind CSS

- [x] Task 5: Implement auth API routes (AC: 1, 2, 5)
  - [x] Create `/app/api/auth/login/route.ts` for login endpoint
  - [x] Create `/app/api/auth/signup/route.ts` for signup endpoint
  - [x] Create `/app/api/auth/logout/route.ts` for logout endpoint
  - [x] Implement proper error handling and response codes
  - [x] Set session cookies on successful auth

- [x] Task 6: Add auth state management (AC: 5)
  - [x] Create auth context provider for client components
  - [x] Implement useAuth hook for accessing auth state
  - [x] Handle auth state persistence
  - [x] Implement redirect logic after successful auth

- [x] Task 7: Write tests for auth components
  - [x] Test LoginForm component validation and submission
  - [x] Test SignupForm component validation and submission
  - [x] Test error message display
  - [x] Test loading states

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2025-01-31 | 1.0 | Initial story creation | Bob (Scrum Master) |
| 2025-01-31 | 1.1 | Story implementation completed | James (Developer) |

## Dev Agent Record

### Debug Log References

### Completion Notes List
- Successfully implemented all authentication UI components
- Created login and signup pages with proper validation
- Implemented Supabase auth integration with helper utilities
- Added comprehensive error handling and loading states
- Created auth context provider for global state management
- Added middleware for route protection
- All tests passing and lint checks clean
- Ready for integration with protected routes in future stories

### File List
- Created `/lib/supabase/client.ts`
- Created `/lib/supabase/server.ts`
- Created `/lib/supabase/middleware.ts`
- Created `/types/auth.ts`
- Created `/app/(auth)/login/page.tsx`
- Created `/app/(auth)/login/_components/LoginForm.tsx`
- Created `/app/(auth)/login/_components/LoginForm.test.tsx`
- Created `/app/(auth)/signup/page.tsx`
- Created `/app/(auth)/signup/_components/SignupForm.tsx`
- Created `/app/(auth)/signup/_components/SignupForm.test.tsx`
- Created `/app/(auth)/layout.tsx`
- Created `/app/api/auth/login/route.ts`
- Created `/app/api/auth/signup/route.ts`
- Created `/app/api/auth/logout/route.ts`
- Created `/lib/auth/AuthContext.tsx`
- Created `/middleware.ts`
- Created `/vitest.config.ts`
- Created `/test/setup.ts`
- Modified `/package.json` (added @supabase/ssr, testing dependencies, and test scripts)

## QA Results